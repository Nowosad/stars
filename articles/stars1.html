<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. introduction • stars</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. introduction">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stars</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stars1.html">1. introduction</a>
    </li>
    <li>
      <a href="../articles/stars2.html">2. stars proxy objects</a>
    </li>
    <li>
      <a href="../articles/stars3.html">3. stars tidyverse methods</a>
    </li>
    <li>
      <a href="../articles/stars4.html">4. stars data model</a>
    </li>
    <li>
      <a href="../articles/stars5.html">5. vector-raster conversions, reprojection, warping</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-spatial/stars">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>1. introduction</h1>
                        <h4 class="author">Edzer Pebesma</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/stars/blob/master/vignettes/stars1.Rmd"><code>vignettes/stars1.Rmd</code></a></small>
      <div class="hidden name"><code>stars1.Rmd</code></div>

    </div>

    
    
<p>Package <code>stars</code> provides infrastructure for <em>data cubes</em>, array data with labeled dimensions, with emphasis on arrays where some of the dimensions relate to time and/or space.</p>
<p>Spatial data cubes are arrays with one or more spatial dimensions. Raster datacubes have at least two spatial dimensions that form the raster tesselation. Vector data cubes have at least one spatial dimension that may for instance reflect a polygon tesselation, or a set of point locations. Conversions between the two (rasterization, polygonization) are provided. Vector data are represented by simple feature geometries (packages <code>sf</code>). Tidyverse methods are provided.</p>
<p>The <code>stars</code> package is loaded by</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(stars)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">## Loading required package: abind</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">## Loading required package: sf</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">## Linking to GEOS 3.5.0, GDAL 2.2.2, PROJ 4.8.0</a></code></pre></div>
<p>Spatiotemporal arrays are stored in objects of class <code>stars</code>; methods for class <code>stars</code> currently available are</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/methods">methods</a></span>(<span class="dt">class =</span> <span class="st">"stars"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">##  [1] [              [&lt;-            $&lt;-            adrop         </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">##  [5] aggregate      aperm          as.data.frame  c             </a>
<a class="sourceLine" id="cb2-4" data-line-number="4">##  [9] coerce         cut            dim            dimnames      </a>
<a class="sourceLine" id="cb2-5" data-line-number="5">## [13] dimnames&lt;-     image          initialize     is.na         </a>
<a class="sourceLine" id="cb2-6" data-line-number="6">## [17] Math           merge          Ops            plot          </a>
<a class="sourceLine" id="cb2-7" data-line-number="7">## [21] print          show           slotsFromS3    split         </a>
<a class="sourceLine" id="cb2-8" data-line-number="8">## [25] st_apply       st_as_sf       st_as_sfc      st_as_stars   </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">## [29] st_bbox        st_coordinates st_crop        st_crs        </a>
<a class="sourceLine" id="cb2-10" data-line-number="10">## [33] st_crs&lt;-       st_dimensions  st_geometry    st_redimension</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">## [37] st_transform   write_stars   </a>
<a class="sourceLine" id="cb2-12" data-line-number="12">## see '?methods' for accessing help and source code</a></code></pre></div>
<p>(tidyverse methods are only visible after loading package <code>tidyverse</code>).</p>
<div id="reading-a-satellite-image" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-a-satellite-image" class="anchor"></a>Reading a satellite image</h1>
<p>We can read a satellite image through GDAL, e.g. from a GeoTIFF file in the package:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">tif =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"tif/L7_ETMs.tif"</span>, <span class="dt">package =</span> <span class="st">"stars"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">x =<span class="st"> </span><span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(tif)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(x)</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We see that the image is geographically referenced (has coordinate values along axes), and that the object returned (<code>x</code>) has three dimensions called <code>x</code>, <code>y</code> and <code>band</code>, and has one attribute.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">x</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">## stars object with 3 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">##   L7_ETMs.tif    </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">##  Min.   :  1.00  </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">##  1st Qu.: 54.00  </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">##  Median : 69.00  </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">##  Mean   : 68.91  </a>
<a class="sourceLine" id="cb4-9" data-line-number="9">##  3rd Qu.: 86.00  </a>
<a class="sourceLine" id="cb4-10" data-line-number="10">##  Max.   :255.00  </a>
<a class="sourceLine" id="cb4-11" data-line-number="11">## dimension(s):</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">##      from  to  offset delta                       refsys point values    </a>
<a class="sourceLine" id="cb4-13" data-line-number="13">## x       1 349  288776  28.5 +proj=utm +zone=25 +south... FALSE   NULL [x]</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">## y       1 352 9120761 -28.5 +proj=utm +zone=25 +south... FALSE   NULL [y]</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">## band    1   6      NA    NA                           NA    NA   NULL</a></code></pre></div>
<p>Each dimension has a name; the meaning of the fields of a single dimension are:</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="88%">
</colgroup>
<thead><tr class="header">
<th><em>field</em></th>
<th><em>meaning</em></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>from</td>
<td>the origin index (1)</td>
</tr>
<tr class="even">
<td>to</td>
<td>the final index (dim(x)[i])</td>
</tr>
<tr class="odd">
<td>offset</td>
<td>the start value for this dimension (pixel boundary), if regular</td>
</tr>
<tr class="even">
<td>delta</td>
<td>the step (pixel, cell) size for this dimension, if regular</td>
</tr>
<tr class="odd">
<td>refsys</td>
<td>the reference system, or proj4string</td>
</tr>
<tr class="even">
<td>point</td>
<td>logical; whether cells refer to points, or intervals</td>
</tr>
<tr class="odd">
<td>values</td>
<td>the sequence of values for this dimension (e.g., geometries), if irregular</td>
</tr>
</tbody>
</table>
<p>This means that for an index i (starting at <span class="math inline">\(i=1\)</span>) along a certain dimension, the corresponding dimension value (coordinate, time) is <span class="math inline">\(\mbox{offset} + (i-1) \times \mbox{delta}\)</span>. This value then refers to the start (edge) of the cell or interval; in order to get the interval middle or cell centre, one needs to add half an offset.</p>
<p>Dimension <code>band</code> is a simple sequence from 1 to 6. Since bands refer to colors, one could put their wavelength values in the <code>values</code> field.</p>
<p>For this particular dataset (and most other raster datasets), we see that offset for dimension <code>y</code> is negative: this means that consecutive array values have decreasing <span class="math inline">\(y\)</span> values: cell indexes increase from top to bottom, in the direction opposite to the <span class="math inline">\(y\)</span> axis.</p>
<p><code>read_stars</code> reads all bands from a raster dataset, or optionally a subset of raster datasets, into a single <code>stars</code> array structure. While doing so, raster values (often UINT8 or UINT16) are converted to double (numeric) values, and scaled back to their original values if needed if the file encodes the scaling parameters.</p>
<p>The data structure <code>stars</code> is a generalisation of the <code>tbl_cube</code> found in <code>dplyr</code>; we can convert to that by</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">## </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">## Attaching package: 'dplyr'</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">## The following objects are masked from 'package:stats':</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">## </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">##     filter, lag</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">## The following objects are masked from 'package:base':</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">## </a>
<a class="sourceLine" id="cb5-9" data-line-number="9">##     intersect, setdiff, setequal, union</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="kw"><a href="https://dplyr.tidyverse.org/reference/as.tbl_cube.html">as.tbl_cube</a></span>(x)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">## Source: local array [737,088 x 3]</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">## D: x [dbl, 349]</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">## D: y [dbl, 352]</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">## D: band [int, 6]</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">## M: L7_ETMs.tif [dbl]</a></code></pre></div>
<p>but this will cause a loss of certain properties (cell size, reference system, vector geometries)</p>
<div id="switching-attributes-to-dimensions-and-back" class="section level2">
<h2 class="hasAnchor">
<a href="#switching-attributes-to-dimensions-and-back" class="anchor"></a>switching attributes to dimensions and back</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">(<span class="dt">x.spl =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/split">split</a></span>(x, <span class="st">"band"</span>))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">## stars object with 2 dimensions and 6 attributes</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">##       X1               X2               X3               X4         </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">##  Min.   : 47.00   Min.   : 32.00   Min.   : 21.00   Min.   :  9.00  </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">##  1st Qu.: 67.00   1st Qu.: 55.00   1st Qu.: 49.00   1st Qu.: 52.00  </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">##  Median : 78.00   Median : 66.00   Median : 63.00   Median : 63.00  </a>
<a class="sourceLine" id="cb6-8" data-line-number="8">##  Mean   : 79.15   Mean   : 67.57   Mean   : 64.36   Mean   : 59.24  </a>
<a class="sourceLine" id="cb6-9" data-line-number="9">##  3rd Qu.: 89.00   3rd Qu.: 79.00   3rd Qu.: 77.00   3rd Qu.: 75.00  </a>
<a class="sourceLine" id="cb6-10" data-line-number="10">##  Max.   :255.00   Max.   :255.00   Max.   :255.00   Max.   :255.00  </a>
<a class="sourceLine" id="cb6-11" data-line-number="11">##       X5               X6         </a>
<a class="sourceLine" id="cb6-12" data-line-number="12">##  Min.   :  1.00   Min.   :  1.00  </a>
<a class="sourceLine" id="cb6-13" data-line-number="13">##  1st Qu.: 63.00   1st Qu.: 32.00  </a>
<a class="sourceLine" id="cb6-14" data-line-number="14">##  Median : 89.00   Median : 60.00  </a>
<a class="sourceLine" id="cb6-15" data-line-number="15">##  Mean   : 83.18   Mean   : 59.98  </a>
<a class="sourceLine" id="cb6-16" data-line-number="16">##  3rd Qu.:112.00   3rd Qu.: 88.00  </a>
<a class="sourceLine" id="cb6-17" data-line-number="17">##  Max.   :255.00   Max.   :255.00  </a>
<a class="sourceLine" id="cb6-18" data-line-number="18">## dimension(s):</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">##   from  to  offset delta                       refsys point values    </a>
<a class="sourceLine" id="cb6-20" data-line-number="20">## x    1 349  288776  28.5 +proj=utm +zone=25 +south... FALSE   NULL [x]</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">## y    1 352 9120761 -28.5 +proj=utm +zone=25 +south... FALSE   NULL [y]</a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(x.spl)</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">## stars object with 3 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">## attribute(s):</a>
<a class="sourceLine" id="cb6-25" data-line-number="25">##        X         </a>
<a class="sourceLine" id="cb6-26" data-line-number="26">##  Min.   :  1.00  </a>
<a class="sourceLine" id="cb6-27" data-line-number="27">##  1st Qu.: 54.00  </a>
<a class="sourceLine" id="cb6-28" data-line-number="28">##  Median : 69.00  </a>
<a class="sourceLine" id="cb6-29" data-line-number="29">##  Mean   : 68.91  </a>
<a class="sourceLine" id="cb6-30" data-line-number="30">##  3rd Qu.: 86.00  </a>
<a class="sourceLine" id="cb6-31" data-line-number="31">##  Max.   :255.00  </a>
<a class="sourceLine" id="cb6-32" data-line-number="32">## dimension(s):</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">##    from  to  offset delta                       refsys point    values    </a>
<a class="sourceLine" id="cb6-34" data-line-number="34">## x     1 349  288776  28.5 +proj=utm +zone=25 +south... FALSE      NULL [x]</a>
<a class="sourceLine" id="cb6-35" data-line-number="35">## y     1 352 9120761 -28.5 +proj=utm +zone=25 +south... FALSE      NULL [y]</a>
<a class="sourceLine" id="cb6-36" data-line-number="36">## X1    1   6      NA    NA                           NA    NA X1,...,X6</a></code></pre></div>
<p>we see that the newly created dimension lost its name, and the single attribute got a default name. We can set attribute names with <code>setNames</code>, and dimension names and values with <code>st_set_dimensions</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(x.spl) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/setNames">setNames</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(x)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/st_dimensions.html">st_set_dimensions</a></span>(<span class="dv">3</span>, <span class="dt">values =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"band"</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/st_dimensions.html">st_set_dimensions</a></span>(<span class="dt">names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"band"</span>))</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">## stars object with 3 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">## attribute(s):</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">##   L7_ETMs.tif    </a>
<a class="sourceLine" id="cb7-7" data-line-number="7">##  Min.   :  1.00  </a>
<a class="sourceLine" id="cb7-8" data-line-number="8">##  1st Qu.: 54.00  </a>
<a class="sourceLine" id="cb7-9" data-line-number="9">##  Median : 69.00  </a>
<a class="sourceLine" id="cb7-10" data-line-number="10">##  Mean   : 68.91  </a>
<a class="sourceLine" id="cb7-11" data-line-number="11">##  3rd Qu.: 86.00  </a>
<a class="sourceLine" id="cb7-12" data-line-number="12">##  Max.   :255.00  </a>
<a class="sourceLine" id="cb7-13" data-line-number="13">## dimension(s):</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">##      from  to  offset delta                       refsys point</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">## x       1 349  288776  28.5 +proj=utm +zone=25 +south... FALSE</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">## y       1 352 9120761 -28.5 +proj=utm +zone=25 +south... FALSE</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">## band    1   6      NA    NA                           NA    NA</a>
<a class="sourceLine" id="cb7-18" data-line-number="18">##               values    </a>
<a class="sourceLine" id="cb7-19" data-line-number="19">## x               NULL [x]</a>
<a class="sourceLine" id="cb7-20" data-line-number="20">## y               NULL [y]</a>
<a class="sourceLine" id="cb7-21" data-line-number="21">## band band1,...,band6</a></code></pre></div>
</div>
<div id="subsetting" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting" class="anchor"></a>Subsetting</h2>
<p>Besides the <code>tidyverse</code> subsetting and selection operators explained in <a href="stars3.html">this vignette</a>, we can also use <code>[</code> and <code>[[</code>.</p>
<p>Since <code>stars</code> objects are a list of <code>array</code>s with a metadata table describing dimensins, list extraction (and assignment) works as expected:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(x[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">## [1] "array"</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(x[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">##    x    y band </a>
<a class="sourceLine" id="cb8-5" data-line-number="5">##  349  352    6</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">x<span class="op">$</span>two =<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">x</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">## stars object with 3 dimensions and 2 attributes</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">## attribute(s):</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">##   L7_ETMs.tif          two       </a>
<a class="sourceLine" id="cb8-11" data-line-number="11">##  Min.   :  1.00   Min.   :  2.0  </a>
<a class="sourceLine" id="cb8-12" data-line-number="12">##  1st Qu.: 54.00   1st Qu.:108.0  </a>
<a class="sourceLine" id="cb8-13" data-line-number="13">##  Median : 69.00   Median :138.0  </a>
<a class="sourceLine" id="cb8-14" data-line-number="14">##  Mean   : 68.91   Mean   :137.8  </a>
<a class="sourceLine" id="cb8-15" data-line-number="15">##  3rd Qu.: 86.00   3rd Qu.:172.0  </a>
<a class="sourceLine" id="cb8-16" data-line-number="16">##  Max.   :255.00   Max.   :510.0  </a>
<a class="sourceLine" id="cb8-17" data-line-number="17">## dimension(s):</a>
<a class="sourceLine" id="cb8-18" data-line-number="18">##      from  to  offset delta                       refsys point values    </a>
<a class="sourceLine" id="cb8-19" data-line-number="19">## x       1 349  288776  28.5 +proj=utm +zone=25 +south... FALSE   NULL [x]</a>
<a class="sourceLine" id="cb8-20" data-line-number="20">## y       1 352 9120761 -28.5 +proj=utm +zone=25 +south... FALSE   NULL [y]</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">## band    1   6      NA    NA                           NA    NA   NULL</a></code></pre></div>
<p>At this level, we can work with <code>array</code> objects directly.</p>
<p>The <code>stars</code> subset operator <code>[</code> works a bit different: its</p>
<ul>
<li>first argument selects attributes</li>
<li>second argument selects the first dimension</li>
<li>third argument selects the second dimension, etc</li>
</ul>
<p>thus,</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">x[<span class="st">"two"</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">## stars object with 3 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">##       two       </a>
<a class="sourceLine" id="cb9-5" data-line-number="5">##  Min.   : 36.0  </a>
<a class="sourceLine" id="cb9-6" data-line-number="6">##  1st Qu.:100.0  </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">##  Median :116.0  </a>
<a class="sourceLine" id="cb9-8" data-line-number="8">##  Mean   :119.7  </a>
<a class="sourceLine" id="cb9-9" data-line-number="9">##  3rd Qu.:136.0  </a>
<a class="sourceLine" id="cb9-10" data-line-number="10">##  Max.   :470.0  </a>
<a class="sourceLine" id="cb9-11" data-line-number="11">## dimension(s):</a>
<a class="sourceLine" id="cb9-12" data-line-number="12">##      from  to  offset delta                       refsys point values    </a>
<a class="sourceLine" id="cb9-13" data-line-number="13">## x       1  10  288776  28.5 +proj=utm +zone=25 +south... FALSE   NULL [x]</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">## y       1 352 9120761 -28.5 +proj=utm +zone=25 +south... FALSE   NULL [y]</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">## band    2   4      NA    NA                           NA    NA   NULL</a></code></pre></div>
<p>selects the second attribute, the first 10 columns (x-coordinate), all rows, and bands 2-4.</p>
<p>Alternatively, when <code>[</code> is given a single argument of class <code>sf</code>, <code>sfc</code> or <code>bbox</code>, <code>[</code> will work as a crop operator:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">circle =<span class="st"> </span><span class="kw">st_sfc</span>(<span class="kw">st_buffer</span>(<span class="kw">st_point</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">293749.5</span>, <span class="dv">9115745</span>)), <span class="dv">400</span>), <span class="dt">crs =</span> <span class="kw">st_crs</span>(x))</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(x[circle][,,,<span class="dv">1</span>], <span class="dt">reset =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(circle, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">'red'</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="overviews" class="section level2">
<h2 class="hasAnchor">
<a href="#overviews" class="anchor"></a>Overviews</h2>
<p>We can read rasters at a lower resolution when they contain so-called overviews. For this GeoTIFF file, the were created with the <code>gdaladdo</code> utility, in particular</p>
<pre><code>gdaladdo -r average L7_ETMs.tif  2 4 8 16</code></pre>
<p>which adds course resolution versions by averaging blocks of pixels.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">(<span class="dt">x =</span> <span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(tif, <span class="dt">options =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"OVERVIEW_LEVEL=1"</span>)))</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">## stars object with 3 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">##   L7_ETMs.tif </a>
<a class="sourceLine" id="cb12-5" data-line-number="5">##  Min.   : 11  </a>
<a class="sourceLine" id="cb12-6" data-line-number="6">##  1st Qu.: 57  </a>
<a class="sourceLine" id="cb12-7" data-line-number="7">##  Median : 70  </a>
<a class="sourceLine" id="cb12-8" data-line-number="8">##  Mean   : 69  </a>
<a class="sourceLine" id="cb12-9" data-line-number="9">##  3rd Qu.: 84  </a>
<a class="sourceLine" id="cb12-10" data-line-number="10">##  Max.   :209  </a>
<a class="sourceLine" id="cb12-11" data-line-number="11">## dimension(s):</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">##      from to  offset   delta                       refsys point values    </a>
<a class="sourceLine" id="cb12-13" data-line-number="13">## x       1 88  288776 113.028 +proj=utm +zone=25 +south... FALSE   NULL [x]</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">## y       1 88 9120761    -114 +proj=utm +zone=25 +south... FALSE   NULL [y]</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">## band    1  6      NA      NA                           NA    NA   NULL</a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(x)</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">(<span class="dt">x =</span> <span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(tif, <span class="dt">options =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"OVERVIEW_LEVEL=2"</span>)))</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">## stars object with 3 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">##   L7_ETMs.tif    </a>
<a class="sourceLine" id="cb13-5" data-line-number="5">##  Min.   : 11.00  </a>
<a class="sourceLine" id="cb13-6" data-line-number="6">##  1st Qu.: 58.00  </a>
<a class="sourceLine" id="cb13-7" data-line-number="7">##  Median : 71.00  </a>
<a class="sourceLine" id="cb13-8" data-line-number="8">##  Mean   : 69.12  </a>
<a class="sourceLine" id="cb13-9" data-line-number="9">##  3rd Qu.: 84.00  </a>
<a class="sourceLine" id="cb13-10" data-line-number="10">##  Max.   :152.00  </a>
<a class="sourceLine" id="cb13-11" data-line-number="11">## dimension(s):</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">##      from to  offset   delta                       refsys point values    </a>
<a class="sourceLine" id="cb13-13" data-line-number="13">## x       1 44  288776 226.057 +proj=utm +zone=25 +south... FALSE   NULL [x]</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">## y       1 44 9120761    -228 +proj=utm +zone=25 +south... FALSE   NULL [y]</a>
<a class="sourceLine" id="cb13-15" data-line-number="15">## band    1  6      NA      NA                           NA    NA   NULL</a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(x)</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">(<span class="dt">x =</span> <span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(tif, <span class="dt">options =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"OVERVIEW_LEVEL=3"</span>)))</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">## stars object with 3 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">##   L7_ETMs.tif    </a>
<a class="sourceLine" id="cb14-5" data-line-number="5">##  Min.   : 12.00  </a>
<a class="sourceLine" id="cb14-6" data-line-number="6">##  1st Qu.: 58.00  </a>
<a class="sourceLine" id="cb14-7" data-line-number="7">##  Median : 71.00  </a>
<a class="sourceLine" id="cb14-8" data-line-number="8">##  Mean   : 69.24  </a>
<a class="sourceLine" id="cb14-9" data-line-number="9">##  3rd Qu.: 83.00  </a>
<a class="sourceLine" id="cb14-10" data-line-number="10">##  Max.   :137.00  </a>
<a class="sourceLine" id="cb14-11" data-line-number="11">## dimension(s):</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">##      from to  offset   delta                       refsys point values    </a>
<a class="sourceLine" id="cb14-13" data-line-number="13">## x       1 22  288776 452.114 +proj=utm +zone=25 +south... FALSE   NULL [x]</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">## y       1 22 9120761    -456 +proj=utm +zone=25 +south... FALSE   NULL [y]</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">## band    1  6      NA      NA                           NA    NA   NULL</a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(x)</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-11-3.png" width="700"></p>
</div>
</div>
<div id="reading-a-raster-time-series-netcdf" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-a-raster-time-series-netcdf" class="anchor"></a>Reading a raster time series: netcdf</h1>
<p>Another example is when we read raster time series model outputs in a NetCDF file, e.g. by</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"nc/bcsd_obs_1999.nc"</span>, <span class="dt">package =</span> <span class="st">"stars"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(<span class="st">"data/full_data_daily_2013.nc"</span>) -&gt;<span class="st"> </span>w</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">## pr, tas,</a></code></pre></div>
<p>We see that</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">w</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">## stars object with 3 dimensions and 2 attributes</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">##    pr [mm/m]         tas [C]      </a>
<a class="sourceLine" id="cb16-5" data-line-number="5">##  Min.   :  0.59   Min.   :-0.421  </a>
<a class="sourceLine" id="cb16-6" data-line-number="6">##  1st Qu.: 56.14   1st Qu.: 8.899  </a>
<a class="sourceLine" id="cb16-7" data-line-number="7">##  Median : 81.88   Median :15.658  </a>
<a class="sourceLine" id="cb16-8" data-line-number="8">##  Mean   :101.26   Mean   :15.489  </a>
<a class="sourceLine" id="cb16-9" data-line-number="9">##  3rd Qu.:121.07   3rd Qu.:21.780  </a>
<a class="sourceLine" id="cb16-10" data-line-number="10">##  Max.   :848.55   Max.   :29.386  </a>
<a class="sourceLine" id="cb16-11" data-line-number="11">##  NA's   :7116     NA's   :7116    </a>
<a class="sourceLine" id="cb16-12" data-line-number="12">## dimension(s):</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">##      from to offset  delta  refsys point                    values    </a>
<a class="sourceLine" id="cb16-14" data-line-number="14">## x       1 81    -85  0.125      NA    NA                      NULL [x]</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">## y       1 33 37.125 -0.125      NA    NA                      NULL [y]</a>
<a class="sourceLine" id="cb16-16" data-line-number="16">## time    1 12     NA     NA POSIXct    NA 1999-01-31,...,1999-12-31</a></code></pre></div>
<p>For this dataset we can see that</p>
<ul>
<li>variables have units associated (and a wrong unit, <code>C</code> is assigned to temperature)</li>
<li>time is now a dimension, with proper units and time steps</li>
</ul>
<p>Alternatively, this dataset can be read using <code>read_ncdf</code>, as in</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"nc/bcsd_obs_1999.nc"</span>, <span class="dt">package =</span> <span class="st">"stars"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/read_ncdf.html">read_ncdf</a></span>()</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">## stars object with 3 dimensions and 2 attributes</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">## attribute(s):</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">##       pr               tas        </a>
<a class="sourceLine" id="cb17-6" data-line-number="6">##  Min.   :  0.59   Min.   :-0.421  </a>
<a class="sourceLine" id="cb17-7" data-line-number="7">##  1st Qu.: 56.14   1st Qu.: 8.899  </a>
<a class="sourceLine" id="cb17-8" data-line-number="8">##  Median : 81.88   Median :15.658  </a>
<a class="sourceLine" id="cb17-9" data-line-number="9">##  Mean   :101.26   Mean   :15.489  </a>
<a class="sourceLine" id="cb17-10" data-line-number="10">##  3rd Qu.:121.07   3rd Qu.:21.780  </a>
<a class="sourceLine" id="cb17-11" data-line-number="11">##  Max.   :848.55   Max.   :29.386  </a>
<a class="sourceLine" id="cb17-12" data-line-number="12">##  NA's   :7116     NA's   :7116    </a>
<a class="sourceLine" id="cb17-13" data-line-number="13">## dimension(s):</a>
<a class="sourceLine" id="cb17-14" data-line-number="14">##           from to offset delta refsys point               values    </a>
<a class="sourceLine" id="cb17-15" data-line-number="15">## longitude    1 81    -85 0.125     NA    NA                 NULL [x]</a>
<a class="sourceLine" id="cb17-16" data-line-number="16">## latitude     1 33     33 0.125     NA    NA                 NULL [y]</a>
<a class="sourceLine" id="cb17-17" data-line-number="17">## time         1 12     NA    NA     NA    NA [12] 17927,...,18261</a></code></pre></div>
<p>which doesn’t convert time values in a proper R time format.</p>
<div id="reading-datasets-from-multiple-files" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-datasets-from-multiple-files" class="anchor"></a>Reading datasets from multiple files</h2>
<p>Model data are often spread across many files. An example of a 0.25 degree grid, global daily sea surface temperature product is found <a href="ftp://eclipse.ncdc.noaa.gov/pub/OI-daily-v2/NetCDF/">here</a>; a subset of the 1981 data was downloaded from <a href="ftp://eclipse.ncdc.noaa.gov/pub/OI-daily-v2/NetCDF/1981/AVHRR/">here</a>.</p>
<p>We read the data by giving <code>read_stars</code> a vector with character names:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">x =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">"avhrr-only-v2.19810901.nc"</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">"avhrr-only-v2.19810902.nc"</span>,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">"avhrr-only-v2.19810903.nc"</span>,</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="st">"avhrr-only-v2.19810904.nc"</span>,</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="st">"avhrr-only-v2.19810905.nc"</span>,</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="st">"avhrr-only-v2.19810906.nc"</span>,</a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="st">"avhrr-only-v2.19810907.nc"</span>,</a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="st">"avhrr-only-v2.19810908.nc"</span>,</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="st">"avhrr-only-v2.19810909.nc"</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co"># see the second vignette:</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co"># install.packages("starsdata", repos = "http://pebesma.staff.ifgi.de", type = "source") </span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14">file_list =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"netcdf/"</span>, x), <span class="dt">package =</span> <span class="st">"starsdata"</span>)</a>
<a class="sourceLine" id="cb18-15" data-line-number="15">(<span class="dt">y =</span> <span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(file_list, <span class="dt">quiet =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb18-16" data-line-number="16">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-17" data-line-number="17"></a>
<a class="sourceLine" id="cb18-18" data-line-number="18">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-19" data-line-number="19"></a>
<a class="sourceLine" id="cb18-20" data-line-number="20">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-21" data-line-number="21"></a>
<a class="sourceLine" id="cb18-22" data-line-number="22">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-23" data-line-number="23"></a>
<a class="sourceLine" id="cb18-24" data-line-number="24">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-25" data-line-number="25"></a>
<a class="sourceLine" id="cb18-26" data-line-number="26">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-27" data-line-number="27"></a>
<a class="sourceLine" id="cb18-28" data-line-number="28">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-29" data-line-number="29"></a>
<a class="sourceLine" id="cb18-30" data-line-number="30">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-31" data-line-number="31"></a>
<a class="sourceLine" id="cb18-32" data-line-number="32">## Warning: ignoring unrecognized unit: percentage</a>
<a class="sourceLine" id="cb18-33" data-line-number="33">## stars object with 4 dimensions and 4 attributes</a>
<a class="sourceLine" id="cb18-34" data-line-number="34">## attribute(s), summary of first 1e+05 cells:</a>
<a class="sourceLine" id="cb18-35" data-line-number="35">##    sst [°*C]       anom [°*C]      err [°*C]          ice       </a>
<a class="sourceLine" id="cb18-36" data-line-number="36">##  Min.   :-1.80   Min.   :-4.69   Min.   :0.110   Min.   :0.010  </a>
<a class="sourceLine" id="cb18-37" data-line-number="37">##  1st Qu.:-1.19   1st Qu.:-0.06   1st Qu.:0.300   1st Qu.:0.730  </a>
<a class="sourceLine" id="cb18-38" data-line-number="38">##  Median :-1.05   Median : 0.52   Median :0.300   Median :0.830  </a>
<a class="sourceLine" id="cb18-39" data-line-number="39">##  Mean   :-0.32   Mean   : 0.23   Mean   :0.295   Mean   :0.766  </a>
<a class="sourceLine" id="cb18-40" data-line-number="40">##  3rd Qu.:-0.20   3rd Qu.: 0.71   3rd Qu.:0.300   3rd Qu.:0.870  </a>
<a class="sourceLine" id="cb18-41" data-line-number="41">##  Max.   : 9.36   Max.   : 3.70   Max.   :0.480   Max.   :1.000  </a>
<a class="sourceLine" id="cb18-42" data-line-number="42">##  NA's   :13360   NA's   :13360   NA's   :13360   NA's   :27377  </a>
<a class="sourceLine" id="cb18-43" data-line-number="43">## dimension(s):</a>
<a class="sourceLine" id="cb18-44" data-line-number="44">##      from   to     offset  delta  refsys point values    </a>
<a class="sourceLine" id="cb18-45" data-line-number="45">## x       1 1440          0   0.25      NA    NA   NULL [x]</a>
<a class="sourceLine" id="cb18-46" data-line-number="46">## y       1  720         90  -0.25      NA    NA   NULL [y]</a>
<a class="sourceLine" id="cb18-47" data-line-number="47">## zlev    1    1      0 [m]     NA      NA    NA   NULL    </a>
<a class="sourceLine" id="cb18-48" data-line-number="48">## time    1    9 1981-09-01 1 days POSIXct    NA   NULL</a></code></pre></div>
<p>Next, we select sea surface temperature (<code>sst</code>), and drop the singular <code>zlev</code> (depth) dimension using <code>adrop</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(abind)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">z &lt;-<span class="st"> </span>y <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(sst) <span class="op">%&gt;%</span><span class="st"> </span>adrop</a></code></pre></div>
<p>We can now graph the sea surface temperature (SST) using <code>ggplot</code>, which needs data in a long table form, and without units:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">## Registered S3 methods overwritten by 'ggplot2':</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">##   method         from </a>
<a class="sourceLine" id="cb20-4" data-line-number="4">##   [.quosures     rlang</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">##   c.quosures     rlang</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">##   print.quosures rlang</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(viridis)</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">## Loading required package: viridisLite</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggthemes)</a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/geom_stars.html">geom_stars</a></span>(<span class="dt">data =</span> z[<span class="dv">1</span>], <span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">downsample =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="st">"time"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/viridis/topics/scale_viridis">scale_fill_viridis</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggthemes/topics/theme_map">theme_map</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.key.width=</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/reexports.html">unit</a></span>(<span class="dv">2</span>, <span class="st">"cm"</span>))</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
</div>
<div id="writing-stars-objects-to-disk" class="section level1">
<h1 class="hasAnchor">
<a href="#writing-stars-objects-to-disk" class="anchor"></a>Writing stars objects to disk</h1>
<p>We can write a stars object to disk by using <code>write_stars</code>; this used the GDAL write engine. Writing NetCDF files without going through the GDAL interface is currently not supported. <code>write_stars</code> currently writes only a single attribute:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../reference/write_stars.html">write_stars</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/abind/topics/adrop">adrop</a></span>(y[<span class="dv">1</span>]), <span class="st">"sst.tif"</span>)</a></code></pre></div>
<p>See the explanation of <code>merge</code> above to see how multiple attributes can be merged (folded) into a dimension.</p>
</div>
<div id="cropping-a-rasters-extent" class="section level1">
<h1 class="hasAnchor">
<a href="#cropping-a-rasters-extent" class="anchor"></a>Cropping a raster’s extent</h1>
<p>Using a curvilinear grid, taken from the example of <code>read_ncdf</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">prec_file =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"nc/test_stageiv_xyt.nc"</span>, <span class="dt">package =</span> <span class="st">"stars"</span>)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">prec =<span class="st"> </span><span class="kw"><a href="../reference/read_ncdf.html">read_ncdf</a></span>(prec_file, <span class="dt">curvilinear =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>))</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">##plot(prec) ## gives error about unique breaks</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">## remove NAs, zeros, and give a large number</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">## of breaks (used for validating in detail)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">qu_<span class="dv">0</span>_omit =<span class="st"> </span><span class="cf">function</span>(x, ..., <span class="dt">n =</span> <span class="dv">22</span>) {</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">  x =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(x)</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(x[x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>], <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> n)))</a>
<a class="sourceLine" id="cb22-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">prec_slice =<span class="st"> </span>stars<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stars/topics/dplyr">slice.stars</a></span>(prec, <span class="dt">index =</span> <span class="dv">17</span>, <span class="dt">along =</span> <span class="st">"time"</span>)</a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(prec_slice, <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">breaks =</span> <span class="kw">qu_0_omit</span>(prec_slice[[<span class="dv">1</span>]]), <span class="dt">reset =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb22-12" data-line-number="12">nc =<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_read">read_sf</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"gpkg/nc.gpkg"</span>, <span class="dt">package =</span> <span class="st">"sf"</span>), <span class="st">"nc.gpkg"</span>)</a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw">st_geometry</span>(nc), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">'red'</span>)</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>we now crop the grid to those cells falling in</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">nc =<span class="st"> </span><span class="kw"><a href="../reference/st_transform.html">st_transform</a></span>(nc, <span class="kw">st_crs</span>(prec_slice)) <span class="co"># datum transformation</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(prec_slice[nc], <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">breaks =</span> <span class="kw">qu_0_omit</span>(prec_slice[[<span class="dv">1</span>]]), <span class="dt">reset =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">## although coordinates are longitude/latitude, st_intersects assumes that they are planar</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw">st_geometry</span>(nc), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">'red'</span>)</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>The selection <code>prec_slice[nc]</code> essentially calls <code><a href="../reference/st_crop.html">st_crop(prec_slice, nc)</a></code> to get a cropped selection. What happened here is that all cells not intersecting with North Carolina (sea) are set to <code>NA</code> values. For regular grids, the extent of the resulting <code>stars</code> object is also be reduced (cropped) by default; this can be controlled with the <code>crop</code> parameter to <code>st_crop</code> and <code>[.stars</code>.</p>
</div>
<div id="vector-data-cube-example" class="section level1">
<h1 class="hasAnchor">
<a href="#vector-data-cube-example" class="anchor"></a>Vector data cube example</h1>
<p>Like <code>tbl_cube</code>, <code>stars</code> arrays have no limits to the number of dimensions they handle. An example is the origin-destination (OD) matrix, by time and travel mode.</p>
<div id="od-space-x-space-x-travel-mode-x-time-x-time" class="section level2">
<h2 class="hasAnchor">
<a href="#od-space-x-space-x-travel-mode-x-time-x-time" class="anchor"></a>OD: space x space x travel mode x time x time</h2>
<p>We create a 5-dimensional matrix of traffic between regions, by day, by time of day, and by travel mode. Having day and time of day each as dimension is an advantage when we want to compute patters over the day, for a certain period.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">nc =<span class="st"> </span><span class="kw">st_read</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"gpkg/nc.gpkg"</span>, <span class="dt">package=</span><span class="st">"sf"</span>)) </a>
<a class="sourceLine" id="cb24-2" data-line-number="2">## Reading layer `nc.gpkg' from data source `/home/travis/R/Library/sf/gpkg/nc.gpkg' using driver `GPKG'</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">## Simple feature collection with 100 features and 14 fields</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">## geometry type:  MULTIPOLYGON</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">## dimension:      XY</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">## bbox:           xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">## epsg (SRID):    4267</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">## proj4string:    +proj=longlat +datum=NAD27 +no_defs</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">to =<span class="st"> </span>from =<span class="st"> </span><span class="kw">st_geometry</span>(nc) <span class="co"># 100 polygons: O and D regions</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10">mode =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"car"</span>, <span class="st">"bike"</span>, <span class="st">"foot"</span>) <span class="co"># travel mode</span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11">day =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span> <span class="co"># arbitrary</span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(units)</a>
<a class="sourceLine" id="cb24-13" data-line-number="13">## Warning in .get_ud_xml_dir(TRUE): multiple udunits databases present: /</a>
<a class="sourceLine" id="cb24-14" data-line-number="14">## home/travis/R/Library/RNetCDF/udunits/udunits2.xml /usr/share/xml/udunits/</a>
<a class="sourceLine" id="cb24-15" data-line-number="15">## udunits2.xml</a>
<a class="sourceLine" id="cb24-16" data-line-number="16">## udunits system database from /home/travis/R/Library/RNetCDF/udunits</a>
<a class="sourceLine" id="cb24-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/units/topics/units">units</a></span>(day) =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/units/topics/as_units">as_units</a></span>(<span class="st">"days since 2015-01-01"</span>)</a>
<a class="sourceLine" id="cb24-18" data-line-number="18">hour =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">0</span><span class="op">:</span><span class="dv">23</span>, h) <span class="co"># hour of day</span></a>
<a class="sourceLine" id="cb24-19" data-line-number="19">dims =<span class="st"> </span><span class="kw"><a href="../reference/st_dimensions.html">st_dimensions</a></span>(<span class="dt">origin =</span> from, <span class="dt">destination =</span> to, <span class="dt">mode =</span> mode, <span class="dt">day =</span> day, <span class="dt">hour =</span> hour)</a>
<a class="sourceLine" id="cb24-20" data-line-number="20">(<span class="dt">n =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(dims))</a>
<a class="sourceLine" id="cb24-21" data-line-number="21">##      origin destination        mode         day        hour </a>
<a class="sourceLine" id="cb24-22" data-line-number="22">##         100         100           3         100          24</a>
<a class="sourceLine" id="cb24-23" data-line-number="23">traffic =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/array">array</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Poisson">rpois</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/prod">prod</a></span>(n), <span class="dv">10</span>), <span class="dt">dim =</span> n) <span class="co"># simulated traffic counts</span></a>
<a class="sourceLine" id="cb24-24" data-line-number="24">(<span class="dt">st =</span> <span class="kw"><a href="../reference/st_as_stars.html">st_as_stars</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">traffic =</span> traffic),  <span class="dt">dimensions =</span> dims))</a>
<a class="sourceLine" id="cb24-25" data-line-number="25">## stars object with 5 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb24-26" data-line-number="26">## attribute(s), summary of first 1e+05 cells:</a>
<a class="sourceLine" id="cb24-27" data-line-number="27">##     traffic      </a>
<a class="sourceLine" id="cb24-28" data-line-number="28">##  Min.   : 0.000  </a>
<a class="sourceLine" id="cb24-29" data-line-number="29">##  1st Qu.: 8.000  </a>
<a class="sourceLine" id="cb24-30" data-line-number="30">##  Median :10.000  </a>
<a class="sourceLine" id="cb24-31" data-line-number="31">##  Mean   : 9.997  </a>
<a class="sourceLine" id="cb24-32" data-line-number="32">##  3rd Qu.:12.000  </a>
<a class="sourceLine" id="cb24-33" data-line-number="33">##  Max.   :27.000  </a>
<a class="sourceLine" id="cb24-34" data-line-number="34">## dimension(s):</a>
<a class="sourceLine" id="cb24-35" data-line-number="35">##             from  to                      offset</a>
<a class="sourceLine" id="cb24-36" data-line-number="36">## origin         1 100                          NA</a>
<a class="sourceLine" id="cb24-37" data-line-number="37">## destination    1 100                          NA</a>
<a class="sourceLine" id="cb24-38" data-line-number="38">## mode           1   3                          NA</a>
<a class="sourceLine" id="cb24-39" data-line-number="39">## day            1 100 1 [(days since 2015-01-01)]</a>
<a class="sourceLine" id="cb24-40" data-line-number="40">## hour           1  24                       0 [h]</a>
<a class="sourceLine" id="cb24-41" data-line-number="41">##                                   delta                       refsys point</a>
<a class="sourceLine" id="cb24-42" data-line-number="42">## origin                               NA +proj=longlat +datum=NAD2... FALSE</a>
<a class="sourceLine" id="cb24-43" data-line-number="43">## destination                          NA +proj=longlat +datum=NAD2... FALSE</a>
<a class="sourceLine" id="cb24-44" data-line-number="44">## mode                                 NA                           NA FALSE</a>
<a class="sourceLine" id="cb24-45" data-line-number="45">## day         1 [(days since 2015-01-01)]                           NA FALSE</a>
<a class="sourceLine" id="cb24-46" data-line-number="46">## hour                              1 [h]                           NA FALSE</a>
<a class="sourceLine" id="cb24-47" data-line-number="47">##                                                                        values</a>
<a class="sourceLine" id="cb24-48" data-line-number="48">## origin      MULTIPOLYGON (((-81.47276 3...,...,MULTIPOLYGON (((-78.65572 3...</a>
<a class="sourceLine" id="cb24-49" data-line-number="49">## destination MULTIPOLYGON (((-81.47276 3...,...,MULTIPOLYGON (((-78.65572 3...</a>
<a class="sourceLine" id="cb24-50" data-line-number="50">## mode                                                             car,...,foot</a>
<a class="sourceLine" id="cb24-51" data-line-number="51">## day                                                                      NULL</a>
<a class="sourceLine" id="cb24-52" data-line-number="52">## hour                                                                     NULL</a></code></pre></div>
<p>This array contains the simple feature geometries of origin and destination so that we can directly plot every slice without additional table joins. If we want to represent such an array as a <code>tbl_cube</code>, the simple feature geometry dimensions need to be replaced by indexes:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">st <span class="op">%&gt;%</span><span class="st"> </span>as.tbl_cube </a>
<a class="sourceLine" id="cb25-2" data-line-number="2">## Source: local array [72,000,000 x 5]</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">## D: origin [int, 100]</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">## D: destination [int, 100]</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">## D: mode [chr, 3]</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">## D: day [[(days since 2015-01-01)], 100]</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">## D: hour [[h], 24]</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">## M: traffic [int]</a></code></pre></div>
<p>The following demonstrates how <code>dplyr</code> can filter bike travel, and compute mean bike traffic by hour of day:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">b &lt;-<span class="st"> </span>st <span class="op">%&gt;%</span><span class="st"> </span>as.tbl_cube <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(mode <span class="op">==</span><span class="st"> "bike"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(hour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">traffic =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(traffic)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>()</a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(ggforce) <span class="co"># for plotting a units variable</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7">## Loading required package: ggforce</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="dt">data=</span>b, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x=</span>hour, <span class="dt">y=</span>traffic))</a></code></pre></div>
<p><img src="stars1_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#reading-a-satellite-image">Reading a satellite image</a><ul class="nav nav-pills nav-stacked">
<li><a href="#switching-attributes-to-dimensions-and-back">switching attributes to dimensions and back</a></li>
      <li><a href="#subsetting">Subsetting</a></li>
      <li><a href="#overviews">Overviews</a></li>
      </ul>
</li>
      <li>
<a href="#reading-a-raster-time-series-netcdf">Reading a raster time series: netcdf</a><ul class="nav nav-pills nav-stacked">
<li><a href="#reading-datasets-from-multiple-files">Reading datasets from multiple files</a></li>
      </ul>
</li>
      <li><a href="#writing-stars-objects-to-disk">Writing stars objects to disk</a></li>
      <li><a href="#cropping-a-rasters-extent">Cropping a raster’s extent</a></li>
      <li>
<a href="#vector-data-cube-example">Vector data cube example</a><ul class="nav nav-pills nav-stacked">
<li><a href="#od-space-x-space-x-travel-mode-x-time-x-time">OD: space x space x travel mode x time x time</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edzer Pebesma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
